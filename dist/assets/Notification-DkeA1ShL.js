import{h as Z,r as s,j as e,M as ee,B as E,b as u,G as m,i as te,k as ae,m as re,n as se,o as ie,p as P,q as w,s as ne,I as A,t as le,D as de,v as oe,w as g,x as ce,f as me,A as F}from"./index-8vjFNNnn.js";import{f as he,u as fe,a as ue,g as pe,d as ge}from"./BannerApi-C-LlOjBZ.js";import{d as xe,h as k}from"./Add-BVPYQ0gu.js";import{E as ve,D as Ne}from"./Edit-BY8Zkq1m.js";const U=[{id:"advertisementId",label:"ID"},{id:"advertisementName",label:"Topic",minWidth:100},{id:"description",label:"Title",minWidth:100},{id:"file",label:"Message"},{id:"createdBy",label:"Created By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ce=()=>{Z();const[p,x]=s.useState(0),[h,W]=s.useState(10),[v,N]=s.useState([]),[R,d]=s.useState(!1),[j,y]=s.useState(!1),[i,o]=s.useState({advertisementName:"",description:"",fileName:""}),[l,b]=s.useState({}),[je,D]=s.useState(""),[ye,B]=s.useState(""),[I,M]=s.useState(null),[O,z]=s.useState(!1),[H,G]=s.useState(null),C=s.useRef(null),L=(t,a)=>{x(a)},$=t=>{W(+t.target.value),x(0)},f=JSON.parse(sessionStorage.getItem("user")),c={"Content-type":"application/json",Authorization:"Bearer "+f.accessToken},q=`${F}/file/downloadFile/?filePath=`,S=async()=>{try{const a=(await he(c)).data.content;if(a){const r=a.map(n=>({advertisementId:n.advertisementId,advertisementName:n.advertisementName,description:n.description,file:n.filePath===null?"NO IMAGE FOUND":e.jsx("img",{src:q+n.filePath,alt:n.fileName,style:{width:100,height:50}}),insertedDate:k(n.insertedDate).format("L"),updatedDate:k(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));N(r)}else N([])}catch(t){console.error("Error fetching data:",t)}};s.useEffect(()=>{S()},[O]);const J=async t=>{t.preventDefault();const a=K();if(Object.keys(a).length>0)b(a);else try{if(j){const r={...i,advertisementId:H,updatedBy:{userId:f.userId}};await fe(r,c)}else await ue(i,c);o({advertisementName:"",description:"",fileName:""}),C.current.value=null,z(r=>!r),d(!1)}catch(r){console.error("Error saving advertisement:",r)}},V=async t=>{if(t.preventDefault(),!I){D("Please select a file");return}const a=new FormData;a.append("file",I);try{const r=await me.post(`${F}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:"Bearer "+f.accessToken}});B(r.data.fileName),alert(r.data.message),o({...i,fileName:r.data.fileName}),D("")}catch(r){console.error("Error uploading file:",r)}},_=t=>{B(t.target.files[0].name),M(t.target.files[0])},K=()=>{const t={};return(!i.advertisementName||i.advertisementName.trim()==="")&&(t.advertisementName="Enter the Advertisement name"),(!i.description||i.description.trim()==="")&&(t.description="Enter the description"),(!i.fileName||i.fileName.trim()==="")&&(t.fileName="Select the file"),t},T=t=>{o({...i,[t.target.name]:t.target.value,createdBy:{userId:f.userId}}),b({...l,[t.target.name]:null})},Q=()=>{y(!1),o({advertisementName:"",description:"",fileName:""}),d(!0)},X=async t=>{y(!0),d(!0);try{const r=(await pe(t,c)).data;G(r.advertisementId),o({advertisementName:r.advertisementName,description:r.description,fileName:r.fileName})}catch(a){console.error("Error fetching advertisement details:",a)}},Y=async t=>{try{await ge(t,c),S()}catch(a){console.error("Error deleting advertisement:",a)}};return e.jsxs(ee,{title:e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Banner"}),e.jsxs(u,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Q,children:["Add",e.jsx(xe,{sx:{color:"#fff"}})]})]}),children:[e.jsx(m,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(re,{sx:{maxHeight:440},children:e.jsxs(se,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ie,{children:e.jsx(P,{children:U.map(t=>e.jsx(w,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(ne,{children:v.slice(p*h,p*h+h).map(t=>e.jsx(P,{hover:!0,role:"checkbox",tabIndex:-1,children:U.map(a=>e.jsx(w,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:()=>X(t.advertisementId),color:"primary",children:e.jsx(ve,{})}),e.jsx(A,{onClick:()=>Y(t.advertisementId),color:"error",children:e.jsx(Ne,{})})]}):t[a.id]},a.id))},t.advertisementId))})]})}),e.jsx(le,{rowsPerPageOptions:[10,25,100],component:"div",count:v.length,rowsPerPage:h,page:p,onPageChange:L,onRowsPerPageChange:$})]}),e.jsxs(de,{open:R,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(oe,{sx:{fontSize:"16px"},children:j?"Edit Advertisement":"Add Advertisement"}),e.jsxs(E,{component:"form",onSubmit:J,noValidate:!0,sx:{p:3},children:[e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Topic",name:"Topic",value:i.advertisementName,onChange:T,error:!!l.advertisementName,helperText:l.advertisementName})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:T,error:!!l.description,helperText:l.description,multiline:!0,rows:3})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(g,{margin:"normal",fullWidth:!0,id:"fileName",label:"File Name",name:"fileName",autoComplete:"fileName",value:i.fileName,disabled:!0,helperText:l.fileName,error:!!l.fileName,InputProps:{endAdornment:e.jsx(u,{variant:"contained",color:"primary",onClick:V,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:_,ref:C,style:{marginTop:20}})]})]}),e.jsxs(ce,{children:[e.jsx(u,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Ce as default};
