import{f as u,h as Z,r as c,j as e,M as ee,b as y,G as g,i as te,k as se,m as ae,n as re,o as oe,p as T,q as k,s as ne,I as E,t as ce,D as ie,v as le,w as x,x as de}from"./index-8vjFNNnn.js";import{d as ue,h as M}from"./Add-BVPYQ0gu.js";import{d as he,a as pe}from"./DeleteForever-Df9ZEjlf.js";import{B as F}from"./Box-C9fJa3mF.js";const me=async o=>await u({method:"get",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/getAllSuccessStoryByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10",headers:o}),ge=async(o,l)=>await u({method:"GET",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/getSuccessStoryById/{successstoryId}?successstoryId=${o}`,headers:l}),fe=async(o,l)=>(console.log(o),await u({method:"PUT",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/updateSuccessStory",headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(function(s){console.log(s)})),ye=async(o,l)=>await u({method:"delete",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/deleteSuccessStoryById/${o}`,headers:l}).then(s=>{s.data.responseCode===200?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(s=>{console.log(s)}),xe=async(o,l)=>{try{return await u({method:"POST",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/createSuccessStory",headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert("Advertisement  added successfully"):s.data.responseCode===400&&alert(s.data.errorMessage)})}catch(s){alert(s)}},A=[{id:"successstoryId",label:"ID"},{id:"successstoryName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ie=()=>{Z();const[o,l]=c.useState(0),[s,U]=c.useState(10),[S,j]=c.useState([]),[N,b]=c.useState(!1),[W,h]=c.useState(!1),[R,z]=c.useState(null),[Se,v]=c.useState(""),[d,w]=c.useState({}),[I,O]=c.useState(null),C=c.useRef(null),[je,D]=c.useState(""),[$,P]=c.useState(!1),[i,p]=c.useState({successstoryName:"",description:""}),G=(t,a)=>{l(a)},H=t=>{U(+t.target.value),l(0)},f=JSON.parse(sessionStorage.getItem("user")),m={"Content-type":"application/json",Authorization:`Bearer ${f.accessToken}`},_="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",L=async()=>{try{const a=(await me(m)).data.content;if(a){const r=a.map(n=>({successstoryId:n.successstoryId,successstoryName:n.successstoryName,description:n.description,file:n.photoPath?e.jsx("img",{src:_+n.photoPath,alt:n.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:M(n.insertedDate).format("L"),updatedDate:M(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));j(r)}else j([])}catch(t){console.error("Error fetching data:",t)}};c.useEffect(()=>{L()},[$]);const q=()=>{const t={};return i.successstoryName.trim()||(t.successstoryName="Enter the News"),i.description.trim()||(t.description="Enter the Description"),(!i.photoName||i.photoName.trim()==="")&&(t.photoName="Select the file"),t},B=t=>{p({...i,[t.target.name]:t.target.value}),w(a=>({...a,[t.target.name]:null}))},J=async t=>{try{await ye(t,m),P(a=>!a)}catch(a){console.error("Error deleting news:",a)}},V=async t=>{b(!0),h(!0);try{const r=(await ge(t,m)).data;z(r.successstoryId),p({successstoryName:r.successstoryName,description:r.description,photoName:r.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},K=async t=>{if(t.preventDefault(),!I){D("Please select a file");return}const a=new FormData;a.append("file",I);try{const r=await u.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${f.accessToken}`}});v(r.data.fileName),p(n=>({...n,photoName:r.data.fileName})),D(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},Q=t=>{v(t.target.files[0].name),O(t.target.files[0])},X=async t=>{t.preventDefault();const a=q();if(console.log(i),Object.keys(a).length>0)w(a);else try{if(N){const r={...i,successstoryId:R,updatedBy:{userId:f.userId}};await fe(r,m)}else{const r={...i,createdBy:{userId:f.userId}};await xe(r,m)}p({successstoryName:"",description:"",photoName:""}),C.current.value=null,P(r=>!r),h(!1)}catch(r){console.error("Error saving news:",r)}},Y=()=>{b(!1),p({successstoryName:"",description:"",photoName:""}),h(!0)};return e.jsxs(ee,{title:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(y,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Y,children:["Add",e.jsx(ue,{sx:{color:"#fff"}})]})]}),children:[e.jsx(g,{container:!0,spacing:te}),e.jsxs(se,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ae,{sx:{maxHeight:440},children:e.jsxs(re,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(oe,{children:e.jsx(T,{children:A.map(t=>e.jsx(k,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(ne,{children:S.slice(o*s,o*s+s).map(t=>e.jsx(T,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(a=>e.jsx(k,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>V(t.successstoryId),color:"primary",children:e.jsx(he,{})}),e.jsx(E,{onClick:()=>J(t.successstoryId),color:"error",children:e.jsx(pe,{})})]}):t[a.id]},a.id))},t.successstoryId))})]})}),e.jsx(ce,{rowsPerPageOptions:[10,25,100],component:"div",count:S.length,rowsPerPage:s,page:o,onPageChange:G,onRowsPerPageChange:H})]}),e.jsxs(ie,{open:W,onClose:()=>h(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(le,{sx:{fontSize:"16px"},children:N?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(F,{component:"form",onSubmit:X,noValidate:!0,sx:{p:3},children:[e.jsxs(g,{container:!0,spacing:2,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:i.successstoryName,onChange:B,error:!!d.successstoryName,helperText:d.successstoryName})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:B,error:!!d.description,helperText:d.description,multiline:!0,rows:3})}),e.jsxs(g,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:i.photoName,disabled:!0,helperText:d.photoName,error:!!d.photoName,InputProps:{endAdornment:e.jsx(y,{variant:"contained",color:"primary",onClick:K,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:C,style:{marginTop:20}})]})]}),e.jsxs(de,{children:[e.jsx(y,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(y,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Ie as default};
