import{f as h,h as Z,r as i,j as e,M as ee,b as w,G as f,i as te,k as ae,m as se,n as ne,o as re,p as T,q as k,s as oe,I as E,t as ie,D as le,v as de,w as x,x as ce}from"./index-8vjFNNnn.js";import{d as he,h as M}from"./Add-BVPYQ0gu.js";import{d as ue,a as pe}from"./DeleteForever-Df9ZEjlf.js";import{B as F}from"./Box-C9fJa3mF.js";const me=async(r,d)=>{try{return await h({method:"POST",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/createNews",headers:d,data:r}).then(function(a){a.data.responseCode===201?alert("Advertisement  added successfully"):a.data.responseCode===400&&alert(a.data.errorMessage)})}catch(a){alert(a)}},fe=async r=>await h({method:"get",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/getAllNewsByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10",headers:r}),ge=async(r,d)=>await h({method:"GET",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/getNewsById/{newsId}?newsId=${r}`,headers:d}),we=async(r,d)=>(console.log(r),await h({method:"PUT",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/updateNews",headers:d,data:r}).then(function(a){a.data.responseCode===201?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(function(a){console.log(a)})),xe=async(r,d)=>await h({method:"delete",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/deleteNewsById/${r}`,headers:d}).then(a=>{a.data.responseCode===200?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(a=>{console.log(a)}),A=[{id:"newsId",label:"ID"},{id:"newsName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ce=()=>{Z();const[r,d]=i.useState(0),[a,U]=i.useState(10),[N,y]=i.useState([]),[j,b]=i.useState(!1),[W,u]=i.useState(!1),[R,z]=i.useState(null),[Ne,v]=i.useState(""),[c,I]=i.useState({}),[C,O]=i.useState(null),D=i.useRef(null),[ye,S]=i.useState(""),[$,P]=i.useState(!1),[l,p]=i.useState({newsName:"",description:""}),G=(t,s)=>{d(s)},H=t=>{U(+t.target.value),d(0)},g=JSON.parse(sessionStorage.getItem("user")),m={"Content-type":"application/json",Authorization:`Bearer ${g.accessToken}`},_="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",L=async()=>{try{const s=(await fe(m)).data.content;if(s){const n=s.map(o=>({newsId:o.newsId,newsName:o.newsName,description:o.description,file:o.photoPath?e.jsx("img",{src:_+o.photoPath,alt:o.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:M(o.insertedDate).format("L"),updatedDate:M(o.updatedDate).format("L"),createdBy:o.createdBy?o.createdBy.userName:"No User",updatedBy:o.updatedBy?o.updatedBy.userName:"No User"}));y(n)}else y([])}catch(t){console.error("Error fetching data:",t)}};i.useEffect(()=>{L()},[$]);const q=()=>{const t={};return l.newsName.trim()||(t.newsName="Enter the News"),l.description.trim()||(t.description="Enter the Description"),(!l.photoName||l.photoName.trim()==="")&&(t.photoName="Select the file"),t},B=t=>{p({...l,[t.target.name]:t.target.value}),I(s=>({...s,[t.target.name]:null}))},J=async t=>{try{await xe(t,m),P(s=>!s)}catch(s){console.error("Error deleting news:",s)}},V=async t=>{b(!0),u(!0);try{const n=(await ge(t,m)).data;z(n.newsId),p({newsName:n.newsName,description:n.description,photoName:n.photoName})}catch(s){console.error("Error fetching news by ID:",s)}},K=async t=>{if(t.preventDefault(),!C){S("Please select a file");return}const s=new FormData;s.append("file",C);try{const n=await h.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",s,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${g.accessToken}`}});v(n.data.fileName),p(o=>({...o,photoName:n.data.fileName})),S(""),alert(n.data.message),console.log(n.data)}catch(n){console.error("Error uploading file:",n)}},Q=t=>{v(t.target.files[0].name),O(t.target.files[0])},X=async t=>{t.preventDefault();const s=q();if(console.log(l),Object.keys(s).length>0)I(s);else try{if(j){const n={...l,newsId:R,updatedBy:{userId:g.userId}};await we(n,m)}else{const n={...l,createdBy:{userId:g.userId}};await me(n,m)}p({newsName:"",description:"",photoName:""}),D.current.value=null,P(n=>!n),u(!1)}catch(n){console.error("Error saving news:",n)}},Y=()=>{b(!1),p({newsName:"",description:"",photoName:""}),u(!0)};return e.jsxs(ee,{title:e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"News"}),e.jsxs(w,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Y,children:["Add",e.jsx(he,{sx:{color:"#fff"}})]})]}),children:[e.jsx(f,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(se,{sx:{maxHeight:440},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(re,{children:e.jsx(T,{children:A.map(t=>e.jsx(k,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(oe,{children:N.slice(r*a,r*a+a).map(t=>e.jsx(T,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(s=>e.jsx(k,{align:s.align,children:s.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(E,{onClick:()=>V(t.newsId),color:"primary",children:e.jsx(ue,{})}),e.jsx(E,{onClick:()=>J(t.newsId),color:"error",children:e.jsx(pe,{})})]}):t[s.id]},s.id))},t.newsId))})]})}),e.jsx(ie,{rowsPerPageOptions:[10,25,100],component:"div",count:N.length,rowsPerPage:a,page:r,onPageChange:G,onRowsPerPageChange:H})]}),e.jsxs(le,{open:W,onClose:()=>u(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(de,{sx:{fontSize:"16px"},children:j?"Edit News":"Add News"}),e.jsxs(F,{component:"form",onSubmit:X,noValidate:!0,sx:{p:3},children:[e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"News Name",name:"newsName",value:l.newsName,onChange:B,error:!!c.newsName,helperText:c.newsName})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:l.description,onChange:B,error:!!c.description,helperText:c.description,multiline:!0,rows:3})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:l.photoName,disabled:!0,helperText:c.photoName,error:!!c.photoName,InputProps:{endAdornment:e.jsx(w,{variant:"contained",color:"primary",onClick:K,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:D,style:{marginTop:20}})]})]}),e.jsxs(ce,{children:[e.jsx(w,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(w,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Ce as default};
